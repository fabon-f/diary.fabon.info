---
import { getSlugFromPath, getTitleFromSlug } from '../lib/utils'
import Layout from '../layouts/Layout.astro'
import Anchor from '../components/Anchor.astro'
import Image from '../components/Image.astro'

export async function getStaticPaths() {
    const posts = await Astro.glob('../posts/*.mdx')

    return posts.map(post => {
        const slug = getSlugFromPath(post.file)
        return ({
            params: {
                slug
            },
            props: {
                post,
                title: post.frontmatter['title'] ?? getTitleFromSlug(slug),
                path: `/${slug}/`
            }
        })
    })
}

const { Content } = Astro.props.post
const { title, path } = Astro.props

const components = {
    a: Anchor,
    img: Image
}
---
<Layout title={title} path={path}>
    <main>
        <article>
            <Content components={components} title={title} />
        </article>
    </main>
</Layout>

<style>
    article :global(h1) {
        font-size: 2em;
        text-align: center;
    }
    article > :global(* + *) {
        margin-block-start: 1rem;
    }
    article > :global(.footnotes) {
        margin-block-start: 3.5em;
        font-size: 0.9em;
        border-block-start: 1px solid #CCC;
    }
    article :global(h2), article :global(h3) {
        border-block-end: 1px solid #CCC;
    }
    article :global(img) {
        max-width: 100%;
        height: auto;
    }
    article :global([data-rehype-pretty-code-title]) {
        font-family: ui-monospace, monospace;
        /* https://www.nordtheme.com/docs/colors-and-palettes */
        background-color: #4c566a;
        color: #eceff4;
        padding: 0.3rem 1rem;
        font-size: 0.9em;
    }
    article :global([data-rehype-pretty-code-fragment]) {
        border-radius: 0.3rem;
        overflow: hidden;
    }
    article :global([data-rehype-pretty-code-fragment] pre) {
        margin: 0;
    }
    article :global(pre > code) {
        display: grid;
        padding: 1rem;
        overflow-x: scroll;
    }
    article :global([data-rehype-pretty-code-fragment] code[data-line-numbers]) {
        padding-inline-start: 10px;
        counter-reset: line;
    }
    article :global([data-rehype-pretty-code-fragment] code[data-line-numbers] > .line::before) {
        counter-increment: line;
        content: counter(line);

        font-family: ui-monospace, monospace;
        display: inline-block;
        width: 1rem;
        margin-right: 1rem;
        text-align: right;
        color: darkgray;
    }
    article :global([data-rehype-pretty-code-fragment] code[data-line-numbers-max-digits="2"] > .line::before) {
        width: 1.5rem;
    }
    article :global([data-rehype-pretty-code-fragment] code[data-line-numbers-max-digits="3"] > .line::before) {
        width: 2rem;
    }
</style>
